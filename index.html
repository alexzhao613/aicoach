<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆæƒ…å ±é–²è¦§ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f3ff 0%, #d1e5ff 100%);
            min-height: 100vh;
            color: #333;
            touch-action: manipulation;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4a90e2;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }

        .btn-primary {
            background: #4a90e2;
            color: white;
        }

        .btn-primary:hover {
            background: #357abd;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: rgba(226, 232, 240, 0.8);
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: rgba(203, 213, 224, 0.9);
            transform: translateY(-1px);
        }

        .btn-danger {
            background: #e53e3e;
            color: white;
        }

        .btn-danger:hover {
            background: #c53030;
            transform: translateY(-1px);
        }

        .login-form {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            max-width: 400px;
            margin: 100px auto;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #4a5568;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid rgba(74, 144, 226, 0.2);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
        }

        .form-input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .profile-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 
                0 8px 32px rgba(31, 38, 135, 0.15),
                inset 0 0 0 1px rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
        }

        .profile-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.35);
            box-shadow: 
                0 12px 40px rgba(31, 38, 135, 0.2),
                inset 0 0 0 1px rgba(255, 255, 255, 0.4);
        }

        .profile-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        .profile-info {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .profile-media {
            width: 100%;
        }

        .profile-name {
            font-size: 1.4rem;
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 5px;
            position: relative;
            display: inline-block;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
        }

        .profile-name:after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, rgba(74, 144, 226, 0.7), transparent);
        }

        .profile-age {
            color: #2d4a77;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.5);
        }

        .info-item {
            display: flex;
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .info-item:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: translateX(5px);
        }

        .info-label {
            font-weight: 500;
            color: #2d4a77;
            min-width: 80px;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.5);
        }

        .info-value {
            color: #1a365d;
            text-shadow: 0 1px 1px rgba(255, 255, 255, 0.5);
        }

        .social-links {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .social-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            text-decoration: none;
            color: white;
            font-weight: 500;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .social-link.instagram {
            background: linear-gradient(45deg, 
                rgba(240, 148, 51, 0.7) 0%, 
                rgba(230, 104, 60, 0.7) 25%, 
                rgba(220, 39, 67, 0.7) 50%, 
                rgba(204, 35, 102, 0.7) 75%, 
                rgba(188, 24, 136, 0.7) 100%);
        }

        .social-link.twitter {
            background: rgba(29, 161, 242, 0.7);
        }

        .social-link.tiktok {
            background: rgba(0, 0, 0, 0.7);
        }

        .social-link.youtube {
            background: rgba(255, 0, 0, 0.7);
        }

        .social-link.other {
            background: rgba(107, 114, 128, 0.7);
        }

        .social-link:hover {
            transform: translateY(-2px);
            filter: brightness(1.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }

        .admin-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .admin-tab {
            padding: 12px 24px;
            background: #f7fafc;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .admin-tab.active {
            background: #5a67d8;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 768px) {
            .form-row {
                grid-template-columns: 1fr 1fr;
            }
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        .alert-success {
            background: rgba(240, 255, 244, 0.9);
            border: 1px solid rgba(154, 230, 180, 0.5);
            color: #22543d;
        }

        .alert-error {
            background: rgba(255, 245, 245, 0.9);
            border: 1px solid rgba(254, 178, 178, 0.5);
            color: #c53030;
        }

        .member-list {
            margin-top: 20px;
        }

        .member-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        /* ç®¡ç†è€…ä»¥å¤–ã«ã¯éè¡¨ç¤ºã«ã™ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .admin-only-field {
            display: none !important;
        }

        /* ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿è¡¨ç¤º */
        body.is-admin .admin-only-field {
            display: flex !important;
        }

        .preview-container {
            margin-top: 10px;
            max-width: 100%;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        .preview-container img {
            max-width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
            max-height: 300px;
            width: 100%;
        }

        .preview-container video {
            max-width: 100%;
            height: auto;
            display: block;
            object-fit: contain;
            max-height: 300px;
            width: 100%;
        }

        input[type="file"] {
            padding: 8px;
            background: rgba(255, 255, 255, 0.3);
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .media-container {
            margin-top: 15px;
            display: grid;
            gap: 15px;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .media-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.2);
            aspect-ratio: 16/9;
            width: 100%;
            max-height: 400px;
        }

        .media-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .media-item video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: rgba(0, 0, 0, 0.05);
        }

        .media-item:hover img {
            transform: scale(1.05);
        }

        /* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ã®ãƒ¡ãƒ‡ã‚£ã‚¢è¡¨ç¤ºèª¿æ•´ */
        .profile-card .media-container {
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            max-height: 200px;
            overflow: hidden;
        }

        .profile-card .media-item {
            max-height: 200px;
        }

        /* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è©³ç´°ãƒšãƒ¼ã‚¸ã®ãƒ¡ãƒ‡ã‚£ã‚¢è¡¨ç¤ºèª¿æ•´ */
        .profile-detail .media-container {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            max-height: none;
            overflow: visible;
        }

        .profile-detail .media-item {
            max-height: 400px;
        }

        /* ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®èª¿æ•´ */
        .media-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .media-preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.2);
        }

        .media-preview-item .remove-media {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(229, 62, 62, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s ease;
            z-index: 10;
            opacity: 0;
        }

        .media-preview-item:hover .remove-media {
            opacity: 1;
        }

        .media-preview-item .remove-media:hover {
            background: rgba(229, 62, 62, 1);
            transform: scale(1.1);
        }

        .media-preview-item img,
        .media-preview-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã®æ”¹å–„ */
        @media (max-width: 768px) {
            .profile-card .media-container {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                max-height: 150px;
            }

            .profile-card .media-item {
                max-height: 150px;
            }

            .profile-detail .media-container {
                grid-template-columns: 1fr;
                max-height: none;
            }

            .profile-detail .media-item {
                max-height: 300px;
            }

            .media-preview-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .profile-card .media-container {
                grid-template-columns: repeat(2, 1fr);
                max-height: 120px;
            }

            .profile-card .media-item {
                max-height: 120px;
            }

            .profile-detail .media-item {
                max-height: 250px;
            }

            .media-preview-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
        }

        /* ç”»åƒèª­ã¿è¾¼ã¿æ™‚ã®ã‚¹ã‚±ãƒ«ãƒˆãƒ³ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°åŠ¹æœ */
        .media-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0) 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                rgba(255, 255, 255, 0) 100%);
            animation: loading 1.5s infinite;
        }

        .media-item.loaded::before {
            display: none;
        }

        @keyframes loading {
            from {
                transform: translateX(-100%);
            }
            to {
                transform: translateX(100%);
            }
        }

        /* å€‹åˆ¥ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .profile-detail {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 30px;
            margin-top: 20px;
            box-shadow: 
                0 8px 32px rgba(31, 38, 135, 0.15),
                inset 0 0 0 1px rgba(255, 255, 255, 0.3);
        }

        .profile-detail .media-container {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            margin-top: 20px;
        }

        .profile-detail .profile-name {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .profile-detail .profile-age {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(74, 144, 226, 0.9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(74, 144, 226, 1);
            transform: translateY(-2px);
        }

        @media (max-width: 768px) {
            .profile-content {
                grid-template-columns: 1fr;
            }

            .profile-detail .media-container {
                grid-template-columns: 1fr;
            }
        }

        .media-upload-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .media-upload-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .media-upload-button {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: rgba(74, 144, 226, 0.9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .media-upload-button:hover {
            background: rgba(74, 144, 226, 1);
            transform: translateY(-2px);
        }

        .media-upload-button input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
        <div id="loginScreen">
            <div class="login-form">
                <h2 style="text-align: center; margin-bottom: 30px; color: #2d3748;">ãƒ­ã‚°ã‚¤ãƒ³</h2>
                <div id="loginAlert"></div>
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</label>
                        <input type="text" id="loginUserId" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                        <input type="password" id="loginPassword" class="form-input" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">ãƒ­ã‚°ã‚¤ãƒ³</button>
                </form>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
        <div id="mainScreen" class="hidden">
            <div class="header">
                <div class="logo">ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆæƒ…å ±ã‚·ã‚¹ãƒ†ãƒ </div>
                <div class="user-info">
                    <span id="currentUser"></span>
                    <button class="btn btn-secondary" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </div>
            </div>

            <!-- ç®¡ç†è€…ãƒ‘ãƒãƒ« -->
            <div id="adminPanel" class="admin-panel hidden">
                <h3 style="margin-bottom: 20px;">ç®¡ç†è€…ãƒ‘ãƒãƒ«</h3>
                <div class="admin-tabs">
                    <button class="admin-tab active" onclick="switchTab('profiles')">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†</button>
                    <button class="admin-tab" onclick="switchTab('members')">ä¼šå“¡ç®¡ç†</button>
                </div>

                <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç† -->
                <div id="profilesTab" class="tab-content active">
                    <div style="margin-bottom: 20px;">
                        <h4>ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†</h4>
                        <button class="btn btn-primary" onclick="showAddProfileForm()" style="margin-top: 10px;">æ–°è¦ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¿½åŠ </button>
                    </div>
                    
                    <div id="addProfileForm" class="hidden" style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h5 style="margin-bottom: 15px;">æ–°è¦ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç™»éŒ²</h5>
                        <form id="profileForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </label>
                                    <input type="text" id="profileNickname" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ç”Ÿå¹´æœˆæ—¥</label>
                                    <input type="date" id="profileBirthdate" class="form-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">è·æ¥­</label>
                                    <input type="text" id="profileOccupation" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">è¶£å‘³</label>
                                    <input type="text" id="profileHobbies" class="form-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">èº«é•·</label>
                                    <input type="number" id="profileHeight" class="form-input" placeholder="cmå˜ä½ã§å…¥åŠ›" min="100" max="250" step="0.1">
                                </div>
                                <div class="form-group admin-only-field">
                                    <label class="form-label">ç´¹ä»‹è€…</label>
                                    <input type="text" id="profileReferrer" class="form-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">ãƒ¡ãƒ‡ã‚£ã‚¢</label>
                                    <div class="media-upload-container">
                                        <label class="media-upload-button">
                                            <span>ğŸ“· ç”»åƒã‚’è¿½åŠ </span>
                                            <input type="file" id="profilePhotos" multiple accept="image/*" onchange="handleMediaUpload(this, 'image')">
                                        </label>
                                        <label class="media-upload-button">
                                            <span>ğŸ¥ å‹•ç”»ã‚’è¿½åŠ </span>
                                            <input type="file" id="profileVideos" multiple accept="video/*" onchange="handleMediaUpload(this, 'video')">
                                        </label>
                                        <div id="mediaPreviewGrid" class="media-preview-grid"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ç®¡ç†è€…ã‹ã‚‰ã®ä¸€è¨€</label>
                                <textarea id="profileComment" class="form-input" style="min-height: 80px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">SNSãƒªãƒ³ã‚¯ (1è¡Œã«ã¤ã1ã¤ã€ã€Œã‚µãƒ¼ãƒ“ã‚¹å:URLã€ã®å½¢å¼)</label>
                                <textarea id="profileSocial" class="form-input" placeholder="Instagram:https://instagram.com/username&#10;Twitter:https://twitter.com/username" style="min-height: 60px;"></textarea>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <button type="submit" class="btn btn-primary">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç™»éŒ²</button>
                                <button type="button" class="btn btn-secondary" onclick="hideAddProfileForm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                            </div>
                        </form>
                    </div>

                    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
                    <div id="editProfileForm" class="hidden" style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h5 style="margin-bottom: 15px;">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†</h5>
                        <form id="editProfileFormElement">
                            <input type="hidden" id="editProfileId">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </label>
                                    <input type="text" id="editProfileNickname" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">ç”Ÿå¹´æœˆæ—¥</label>
                                    <input type="date" id="editProfileBirthdate" class="form-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">è·æ¥­</label>
                                    <input type="text" id="editProfileOccupation" class="form-input">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">è¶£å‘³</label>
                                    <input type="text" id="editProfileHobbies" class="form-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">èº«é•·</label>
                                    <input type="number" id="editProfileHeight" class="form-input" placeholder="cmå˜ä½ã§å…¥åŠ›" min="100" max="250" step="0.1">
                                </div>
                                <div class="form-group admin-only-field">
                                    <label class="form-label">ç´¹ä»‹è€…</label>
                                    <input type="text" id="editProfileReferrer" class="form-input">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">ãƒ¡ãƒ‡ã‚£ã‚¢</label>
                                    <div class="media-upload-container">
                                        <label class="media-upload-button">
                                            <span>ğŸ“· ç”»åƒã‚’è¿½åŠ </span>
                                            <input type="file" id="editProfilePhotos" multiple accept="image/*" onchange="handleMediaUpload(this, 'image', true)">
                                        </label>
                                        <label class="media-upload-button">
                                            <span>ğŸ¥ å‹•ç”»ã‚’è¿½åŠ </span>
                                            <input type="file" id="editProfileVideos" multiple accept="video/*" onchange="handleMediaUpload(this, 'video', true)">
                                        </label>
                                        <div id="editMediaPreviewGrid" class="media-preview-grid"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ç®¡ç†è€…ã‹ã‚‰ã®ä¸€è¨€</label>
                                <textarea id="editProfileComment" class="form-input" style="min-height: 80px;"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">SNSãƒªãƒ³ã‚¯ (1è¡Œã«ã¤ã1ã¤ã€ã€Œã‚µãƒ¼ãƒ“ã‚¹å:URLã€ã®å½¢å¼)</label>
                                <textarea id="editProfileSocial" class="form-input" placeholder="Instagram:https://instagram.com/username&#10;Twitter:https://twitter.com/username" style="min-height: 60px;"></textarea>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <button type="submit" class="btn btn-primary">å¤‰æ›´ã‚’ä¿å­˜</button>
                                <button type="button" class="btn btn-secondary" onclick="hideEditProfileForm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- ä¼šå“¡ç®¡ç† -->
                <div id="membersTab" class="tab-content">
                    <div style="margin-bottom: 20px;">
                        <h4>ä¼šå“¡ç®¡ç†</h4>
                        <button class="btn btn-primary" onclick="showAddMemberForm()" style="margin-top: 10px;">æ–°è¦ä¼šå“¡è¿½åŠ </button>
                    </div>
                    
                    <div id="addMemberForm" class="hidden" style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h5 style="margin-bottom: 15px;">æ–°è¦ä¼šå“¡ç™»éŒ²</h5>
                        <form id="memberForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</label>
                                    <input type="text" id="memberUserId" class="form-input" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                                    <input type="password" id="memberPassword" class="form-input" required>
                                </div>
                            </div>
                            <div style="margin-top: 20px;">
                                <button type="submit" class="btn btn-primary">ä¼šå“¡ç™»éŒ²</button>
                                <button type="button" class="btn btn-secondary" onclick="hideAddMemberForm()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                            </div>
                        </form>
                    </div>

                    <div class="member-list" id="memberList">
                        <!-- ä¼šå“¡ä¸€è¦§ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                    </div>
                </div>
            </div>

            <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¸€è¦§ -->
            <div id="profileGrid" class="profile-grid">
                <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿
        var currentUser = null;
        var users = [
            { id: 'admin', password: 'admin123', role: 'admin' },
            { id: 'member1', password: 'pass123', role: 'member' }
        ];
        
        var profiles = [
            {
                id: 1,
                nickname: 'ã•ãã‚‰',
                birthdate: '1995-04-15',
                occupation: 'ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼',
                hobbies: 'èª­æ›¸ã€æ˜ ç”»é‘‘è³ã€ã‚«ãƒ•ã‚§å·¡ã‚Š',
                referrer: 'å±±ç”°å¤ªéƒ',
                comment: 'æ˜ã‚‹ãã¦å„ªã—ã„æ€§æ ¼ã§ã™ã€‚ã„ã¤ã‚‚ç¬‘é¡”ã§å‘¨ã‚Šã‚’å’Œã¾ã›ã¦ãã‚Œã¾ã™ã€‚',
                social: [
                    { platform: 'Instagram', url: 'https://instagram.com/sakura' },
                    { platform: 'Twitter', url: 'https://twitter.com/sakura' }
                ],
                active: true
            },
            {
                id: 2,
                nickname: 'ã¿ãŠ',
                birthdate: '1992-08-20',
                occupation: 'ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼',
                hobbies: 'ãƒ¨ã‚¬ã€æ–™ç†ã€æ—…è¡Œ',
                referrer: 'ä½è—¤èŠ±å­',
                comment: 'ãƒ˜ãƒ«ã‚·ãƒ¼ãªç”Ÿæ´»ã‚’å¿ƒãŒã‘ã¦ã„ã¾ã™ã€‚ä¸€ç·’ã«æ¥½ã—ã„æ™‚é–“ã‚’éã”ã—ã¾ã—ã‚‡ã†ã€‚',
                social: [
                    { platform: 'Instagram', url: 'https://instagram.com/mio' },
                    { platform: 'TikTok', url: 'https://tiktok.com/@mio' }
                ],
                active: true
            }
        ];

        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
        function loadStoredData() {
            const storedUsers = localStorage.getItem('users');
            const storedProfiles = localStorage.getItem('profiles');
            
            if (storedUsers) {
                users = JSON.parse(storedUsers);
            }
            
            if (storedProfiles) {
                profiles = JSON.parse(storedProfiles);
            }
        }

        // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
        function saveDataToStorage() {
            localStorage.setItem('users', JSON.stringify(users));
            localStorage.setItem('profiles', JSON.stringify(profiles));
        }

        // å¹´é½¢è¨ˆç®—
        function calculateAge(birthdate) {
            if (!birthdate) return null;
            var today = new Date();
            var birth = new Date(birthdate);
            var age = today.getFullYear() - birth.getFullYear();
            var monthDiff = today.getMonth() - birth.getMonth();
            if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }

        // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
        function showAlert(type, message, containerId) {
            var alertClass = type === 'success' ? 'alert-success' : 'alert-error';
            var container = containerId ? document.getElementById(containerId) : document.body;
            
            // æ—¢å­˜ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å‰Šé™¤
            var existing = container.querySelector('.alert');
            if (existing) {
                existing.remove();
            }
            
            var alertDiv = document.createElement('div');
            alertDiv.className = 'alert ' + alertClass;
            alertDiv.textContent = message;
            
            container.insertBefore(alertDiv, container.firstChild);
            
            // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
            setTimeout(function() {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 3000);
        }

        // SNSæƒ…å ±ã‚’å–å¾—
        function getSocialInfo(platform, url) {
            var lowerPlatform = platform.toLowerCase();
            var lowerUrl = url.toLowerCase();
            
            if (lowerUrl.indexOf('instagram.com') !== -1 || lowerPlatform.indexOf('instagram') !== -1) {
                return { name: 'Instagram', icon: 'ğŸ“·', class: 'instagram' };
            } else if (lowerUrl.indexOf('twitter.com') !== -1 || lowerUrl.indexOf('x.com') !== -1 || lowerPlatform.indexOf('twitter') !== -1) {
                return { name: 'Twitter', icon: 'ğŸ¦', class: 'twitter' };
            } else if (lowerUrl.indexOf('tiktok.com') !== -1 || lowerPlatform.indexOf('tiktok') !== -1) {
                return { name: 'TikTok', icon: 'ğŸµ', class: 'tiktok' };
            } else if (lowerUrl.indexOf('youtube.com') !== -1 || lowerPlatform.indexOf('youtube') !== -1) {
                return { name: 'YouTube', icon: 'ğŸ“º', class: 'youtube' };
            } else {
                return { name: platform, icon: 'ğŸ”—', class: 'other' };
            }
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¸€è¦§è¡¨ç¤º
        function loadProfiles() {
            var grid = document.getElementById('profileGrid');
            grid.innerHTML = '';
            
            for (var i = 0; i < profiles.length; i++) {
                var profile = profiles[i];
                if (profile.active) {
                    var card = createProfileCard(profile);
                    grid.appendChild(card);
                }
            }
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ä½œæˆé–¢æ•°ã®æ›´æ–°
        function createProfileCard(profile) {
            var card = document.createElement('div');
            card.className = 'profile-card';
            
            var age = calculateAge(profile.birthdate);
            var ageDisplay = age ? age + 'æ­³' : '';
            
            var infoItems = '';
            if (profile.height) infoItems += '<div class="info-item"><span class="info-label">èº«é•·:</span><span class="info-value">' + profile.height + 'cm</span></div>';
            if (profile.occupation) infoItems += '<div class="info-item"><span class="info-label">è·æ¥­:</span><span class="info-value">' + profile.occupation + '</span></div>';
            if (profile.hobbies) infoItems += '<div class="info-item"><span class="info-label">è¶£å‘³:</span><span class="info-value">' + profile.hobbies + '</span></div>';
            if (profile.comment) infoItems += '<div class="info-item"><span class="info-label">ä¸€è¨€:</span><span class="info-value">' + profile.comment + '</span></div>';
            // ç´¹ä»‹è€…æƒ…å ±ã¯ç®¡ç†è€…ã®ã¿ã«è¡¨ç¤º
            if (currentUser && currentUser.role === 'admin' && profile.referrer) {
                infoItems += '<div class="info-item admin-only-field"><span class="info-label">ç´¹ä»‹è€…:</span><span class="info-value">' + profile.referrer + '</span></div>';
            }

            var mediaContent = '';
            if (profile.media && profile.media.length > 0) {
                mediaContent = '<div class="media-container">';
                profile.media.forEach((media, index) => {
                    if (index < 2) { // ã‚«ãƒ¼ãƒ‰ã§ã¯æœ€åˆã®2ã¤ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã®ã¿è¡¨ç¤º
                        if (media.type === 'image') {
                            mediaContent += `
                                <div class="media-item">
                                    <img src="${media.data}" alt="${profile.nickname}ã®ãƒ¡ãƒ‡ã‚£ã‚¢" loading="lazy" onload="handleMediaLoad(this)">
                                </div>`;
                        } else {
                            mediaContent += `
                                <div class="media-item">
                                    <video controls playsinline onloadeddata="handleMediaLoad(this)">
                                        <source src="${media.data}">
                                        å‹•ç”»ã‚’å†ç”Ÿã§ãã¾ã›ã‚“
                                    </video>
                                </div>`;
                        }
                    }
                });
                if (profile.media.length > 2) {
                    mediaContent += `
                        <div class="media-item" style="display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.1);">
                            <span style="font-size: 1.2em; color: #4a5568;">+${profile.media.length - 2}æš</span>
                        </div>`;
                }
                mediaContent += '</div>';
            }

            var socialLinks = '';
            if (profile.social && profile.social.length > 0) {
                socialLinks = '<div class="social-links">';
                for (var i = 0; i < profile.social.length; i++) {
                    var social = profile.social[i];
                    var socialInfo = getSocialInfo(social.platform, social.url);
                    socialLinks += `<a href="${social.url}" class="social-link ${socialInfo.class}" target="_blank" onclick="event.stopPropagation();">`;
                    socialLinks += '<span>' + socialInfo.icon + '</span>';
                    socialLinks += socialInfo.name;
                    socialLinks += '</a>';
                }
                socialLinks += '</div>';
            }

            var adminControls = '';
            if (currentUser && currentUser.role === 'admin') {
                adminControls = `
                    <div class="admin-controls" style="margin-top: 15px; display: flex; gap: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="handleEditClick(event, ${profile.id})">ç·¨é›†</button>
                        <button type="button" class="btn btn-danger" onclick="handleToggleClick(event, ${profile.id})">åœæ­¢</button>
                    </div>`;
            }
            
            card.innerHTML = `
                <div class="profile-content" onclick="handleProfileClick(event, ${profile.id})">
                    <div class="profile-info">
                        <div class="profile-name">${profile.nickname}</div>
                        ${ageDisplay ? '<div class="profile-age">' + ageDisplay + '</div>' : ''}
                        <div>${infoItems}</div>
                        ${profile.comment ? '<div style="margin-top: 15px; color: #4a5568;">' + profile.comment + '</div>' : ''}
                        ${socialLinks}
                        ${adminControls}
                    </div>
                    <div class="profile-media">
                        ${mediaContent}
                    </div>
                </div>`;
            
            return card;
        }

        // ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼é–¢æ•°
        function handleProfileClick(event, profileId) {
            // ç®¡ç†è€…ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¨ãƒªã‚¢ã®ã‚¯ãƒªãƒƒã‚¯ã¯ç„¡è¦–
            if (event.target.closest('.admin-controls')) {
                return;
            }
            showProfileDetail(profileId);
        }

        function handleEditClick(event, profileId) {
            event.stopPropagation();
            editProfile(profileId);
        }

        function handleToggleClick(event, profileId) {
            event.stopPropagation();
            toggleProfile(profileId);
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è©³ç´°è¡¨ç¤ºé–¢æ•°ã®æ›´æ–°
        function showProfileDetail(profileId) {
            var profile = profiles.find(p => p.id === profileId);
            if (!profile) return;

            var mainScreen = document.getElementById('mainScreen');
            var profileGrid = document.getElementById('profileGrid');
            var adminPanel = document.getElementById('adminPanel');
            
            // ç®¡ç†è€…ãƒ‘ãƒãƒ«ã‚’éè¡¨ç¤º
            if (adminPanel) {
                adminPanel.style.display = 'none';
            }

            var age = calculateAge(profile.birthdate);
            var ageDisplay = age ? age + 'æ­³' : '';
            
            var infoItems = '';
            if (profile.height) infoItems += '<div class="info-item"><span class="info-label">èº«é•·:</span><span class="info-value">' + profile.height + 'cm</span></div>';
            if (profile.occupation) infoItems += '<div class="info-item"><span class="info-label">è·æ¥­:</span><span class="info-value">' + profile.occupation + '</span></div>';
            if (profile.hobbies) infoItems += '<div class="info-item"><span class="info-label">è¶£å‘³:</span><span class="info-value">' + profile.hobbies + '</span></div>';
            if (profile.comment) infoItems += '<div class="info-item"><span class="info-label">ä¸€è¨€:</span><span class="info-value">' + profile.comment + '</span></div>';
            // ç´¹ä»‹è€…æƒ…å ±ã¯ç®¡ç†è€…ã®ã¿ã«è¡¨ç¤º
            if (currentUser && currentUser.role === 'admin' && profile.referrer) {
                infoItems += '<div class="info-item admin-only-field"><span class="info-label">ç´¹ä»‹è€…:</span><span class="info-value">' + profile.referrer + '</span></div>';
            }

            var mediaContent = '';
            if (profile.media && profile.media.length > 0) {
                mediaContent = '<div class="media-container">';
                profile.media.forEach(media => {
                    if (media.type === 'image') {
                        mediaContent += `
                            <div class="media-item">
                                <img src="${media.data}" alt="${profile.nickname}ã®ãƒ¡ãƒ‡ã‚£ã‚¢" onload="handleMediaLoad(this)">
                            </div>`;
                    } else {
                        mediaContent += `
                            <div class="media-item">
                                <video controls playsinline onloadeddata="handleMediaLoad(this)">
                                    <source src="${media.data}">
                                    å‹•ç”»ã‚’å†ç”Ÿã§ãã¾ã›ã‚“
                                </video>
                            </div>`;
                    }
                });
                mediaContent += '</div>';
            }

            var socialLinks = '';
            if (profile.social && profile.social.length > 0) {
                socialLinks = '<div class="social-links">';
                for (var i = 0; i < profile.social.length; i++) {
                    var social = profile.social[i];
                    var socialInfo = getSocialInfo(social.platform, social.url);
                    socialLinks += `<a href="${social.url}" class="social-link ${socialInfo.class}" target="_blank">`;
                    socialLinks += '<span>' + socialInfo.icon + '</span>';
                    socialLinks += socialInfo.name;
                    socialLinks += '</a>';
                }
                socialLinks += '</div>';
            }

            var adminControls = '';
            if (currentUser && currentUser.role === 'admin') {
                adminControls = `
                    <div class="admin-controls" style="margin-top: 15px; display: flex; gap: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="handleEditClick(event, ${profile.id})">ç·¨é›†</button>
                        <button type="button" class="btn btn-danger" onclick="handleToggleClick(event, ${profile.id})">åœæ­¢</button>
                    </div>`;
            }

            profileGrid.innerHTML = `
                <button class="back-button" onclick="restoreProfileList()">
                    â† ä¸€è¦§ã«æˆ»ã‚‹
                </button>
                <div class="profile-detail">
                    <div class="profile-name">${profile.nickname}</div>
                    ${ageDisplay ? '<div class="profile-age">' + ageDisplay + '</div>' : ''}
                    <div class="info-items">${infoItems}</div>
                    ${profile.comment ? '<div style="margin: 20px 0; color: #4a5568;">' + profile.comment + '</div>' : ''}
                    ${mediaContent}
                    ${socialLinks}
                    ${adminControls}
                </div>`;
        }

        // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            var userId = document.getElementById('loginUserId').value;
            var password = document.getElementById('loginPassword').value;
            
            var user = null;
            for (var i = 0; i < users.length; i++) {
                if (users[i].id === userId && users[i].password === password) {
                    user = users[i];
                    break;
                }
            }
            
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainScreen').classList.remove('hidden');
                document.getElementById('currentUser').textContent = user.id + ' (' + (user.role === 'admin' ? 'ç®¡ç†è€…' : 'ä¼šå“¡') + ')';
                
                // ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã®ã¿bodyã«is-adminã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
                if (user.role === 'admin') {
                    document.body.classList.add('is-admin');
                    document.getElementById('adminPanel').classList.remove('hidden');
                    loadMemberList();
                } else {
                    document.body.classList.remove('is-admin');
                }
                
                loadProfiles();
                showAlert('success', 'ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸ');
            } else {
                showAlert('error', 'ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“', 'loginAlert');
            }
        });

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        function logout() {
            currentUser = null;
            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('loginUserId').value = '';
            document.getElementById('loginPassword').value = '';
            document.body.classList.remove('is-admin'); // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ™‚ã«is-adminã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
        }

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            var tabs = document.querySelectorAll('.admin-tab');
            var contents = document.querySelectorAll('.tab-content');
            
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            for (var i = 0; i < contents.length; i++) {
                contents[i].classList.remove('active');
            }
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º/éè¡¨ç¤º
        function showAddProfileForm() {
            document.getElementById('addProfileForm').classList.remove('hidden');
        }

        function hideAddProfileForm() {
            document.getElementById('addProfileForm').classList.add('hidden');
            document.getElementById('profileForm').reset();
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç™»éŒ²
        document.getElementById('profileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‡ãƒ¼ã‚¿ã®åé›†
            const mediaItems = document.querySelectorAll('#mediaPreviewGrid .media-preview-item');
            const mediaData = Array.from(mediaItems).map(item => ({
                type: item.querySelector('[name="mediaType"]').value,
                data: item.querySelector('[name="mediaData"]').value
            }));

            var newProfile = {
                id: profiles.length + 1,
                nickname: document.getElementById('profileNickname').value,
                birthdate: document.getElementById('profileBirthdate').value,
                height: document.getElementById('profileHeight').value,
                occupation: document.getElementById('profileOccupation').value,
                hobbies: document.getElementById('profileHobbies').value,
                referrer: document.getElementById('profileReferrer').value,
                comment: document.getElementById('profileComment').value,
                media: mediaData,
                social: parseSocialLinks(document.getElementById('profileSocial').value),
                active: true
            };
            
            profiles.push(newProfile);
            saveDataToStorage();
            loadProfiles();
            hideAddProfileForm();
            document.getElementById('profileForm').reset();
            document.getElementById('mediaPreviewGrid').innerHTML = '';
            showAlert('success', 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
        });

        // ä¼šå“¡è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º/éè¡¨ç¤º
        function showAddMemberForm() {
            document.getElementById('addMemberForm').classList.remove('hidden');
        }

        function hideAddMemberForm() {
            document.getElementById('addMemberForm').classList.add('hidden');
            document.getElementById('memberForm').reset();
        }

        // ä¼šå“¡ç™»éŒ²
        document.getElementById('memberForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            var userId = document.getElementById('memberUserId').value;
            var password = document.getElementById('memberPassword').value;
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯
            var exists = false;
            for (var i = 0; i < users.length; i++) {
                if (users[i].id === userId) {
                    exists = true;
                    break;
                }
            }
            
            if (exists) {
                showAlert('error', 'ãã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã¯æ—¢ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™');
                return;
            }
            
            var newUser = {
                id: userId,
                password: password,
                role: 'member'
            };
            
            users.push(newUser);
            saveDataToStorage(); // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            loadMemberList();
            hideAddMemberForm();
            showAlert('success', 'ä¼šå“¡ã‚’ç™»éŒ²ã—ã¾ã—ãŸ');
        });

        // ä¼šå“¡ä¸€è¦§è¡¨ç¤º
        function loadMemberList() {
            var list = document.getElementById('memberList');
            list.innerHTML = '';
            
            for (var i = 0; i < users.length; i++) {
                var user = users[i];
                if (user.role === 'member') {
                    var item = document.createElement('div');
                    item.className = 'member-item';
                    item.innerHTML = 
                        '<div><strong>' + user.id + '</strong><span style="margin-left: 10px; color: #718096;">ä¼šå“¡</span></div>' +
                        '<div><button class="btn btn-danger" onclick="deleteMember(\'' + user.id + '\')">å‰Šé™¤</button></div>';
                    list.appendChild(item);
                }
            }
        }

        // ä¼šå“¡å‰Šé™¤
        function deleteMember(userId) {
            if (confirm('ã“ã®ä¼šå“¡ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                for (var i = 0; i < users.length; i++) {
                    if (users[i].id === userId) {
                        users.splice(i, 1);
                        break;
                    }
                }
                saveDataToStorage(); // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                loadMemberList();
                showAlert('success', 'ä¼šå“¡ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            }
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«åœæ­¢/å¾©æ´»
        function toggleProfile(profileId) {
            for (var i = 0; i < profiles.length; i++) {
                if (profiles[i].id === profileId) {
                    profiles[i].active = !profiles[i].active;
                    saveDataToStorage(); // ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
                    loadProfiles();
                    showAlert('success', profiles[i].active ? 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’å¾©æ´»ã—ã¾ã—ãŸ' : 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’åœæ­¢ã—ã¾ã—ãŸ');
                    break;
                }
            }
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ï¼ˆå®Ÿè£…ï¼‰
        function editProfile(profileId) {
            var profile = profiles.find(p => p.id === profileId);
            if (!profile) return;

            document.getElementById('editProfileId').value = profile.id;
            document.getElementById('editProfileNickname').value = profile.nickname;
            document.getElementById('editProfileBirthdate').value = profile.birthdate || '';
            document.getElementById('editProfileHeight').value = profile.height || '';
            document.getElementById('editProfileOccupation').value = profile.occupation || '';
            document.getElementById('editProfileHobbies').value = profile.hobbies || '';
            document.getElementById('editProfileReferrer').value = profile.referrer || '';
            document.getElementById('editProfileComment').value = profile.comment || '';

            // ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è¨­å®š
            var editMediaPreviewGrid = document.getElementById('editMediaPreviewGrid');
            editMediaPreviewGrid.innerHTML = '';
            
            if (profile.media && profile.media.length > 0) {
                profile.media.forEach((media, index) => {
                    const mediaItem = document.createElement('div');
                    mediaItem.className = 'media-preview-item';
                    
                    if (media.type === 'image') {
                        mediaItem.innerHTML = `
                            <img src="${media.data}" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼" onload="handleMediaLoad(this)">
                            <button type="button" class="remove-media" onclick="removeMedia(this, ${profile.id}, ${index})">Ã—</button>
                            <input type="hidden" name="mediaData" value="${media.data}">
                            <input type="hidden" name="mediaType" value="image">
                        `;
                    } else {
                        mediaItem.innerHTML = `
                            <video controls onloadeddata="handleMediaLoad(this)">
                                <source src="${media.data}">
                                å‹•ç”»ã‚’å†ç”Ÿã§ãã¾ã›ã‚“
                            </video>
                            <button type="button" class="remove-media" onclick="removeMedia(this, ${profile.id}, ${index})">Ã—</button>
                            <input type="hidden" name="mediaData" value="${media.data}">
                            <input type="hidden" name="mediaType" value="video">
                        `;
                    }
                    
                    editMediaPreviewGrid.appendChild(mediaItem);
                });
            }

            // SNSãƒªãƒ³ã‚¯ã®è¨­å®š
            var socialText = '';
            if (profile.social && profile.social.length > 0) {
                socialText = profile.social.map(s => s.platform + ':' + s.url).join('\n');
            }
            document.getElementById('editProfileSocial').value = socialText;

            // ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤º
            document.getElementById('editProfileForm').classList.remove('hidden');
            document.getElementById('addProfileForm').classList.add('hidden');
        }

        // ãƒ¡ãƒ‡ã‚£ã‚¢å‰Šé™¤å‡¦ç†ã®æ›´æ–°
        function removeMedia(button, profileId, mediaIndex) {
            const profile = profiles.find(p => p.id === profileId);
            if (!profile) return;

            // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã®ãƒ¡ãƒ‡ã‚£ã‚¢é…åˆ—ã‹ã‚‰è©²å½“ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã‚’å‰Šé™¤
            if (profile.media) {
                profile.media.splice(mediaIndex, 1);
                saveDataToStorage();
            }

            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦ç´ ã‚’å‰Šé™¤
            button.closest('.media-preview-item').remove();
            showAlert('success', 'ãƒ¡ãƒ‡ã‚£ã‚¢ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡å‡¦ç†ã‚’æ›´æ–°
        document.getElementById('editProfileFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            
            var profileId = parseInt(document.getElementById('editProfileId').value);
            
            // ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ‡ãƒ¼ã‚¿ã®åé›†
            const mediaItems = document.querySelectorAll('#editMediaPreviewGrid .media-preview-item');
            const mediaData = Array.from(mediaItems).map(item => ({
                type: item.querySelector('[name="mediaType"]').value,
                data: item.querySelector('[name="mediaData"]').value
            }));

            var profileIndex = profiles.findIndex(p => p.id === profileId);
            if (profileIndex !== -1) {
                profiles[profileIndex] = {
                    ...profiles[profileIndex],
                    nickname: document.getElementById('editProfileNickname').value,
                    birthdate: document.getElementById('editProfileBirthdate').value,
                    height: document.getElementById('editProfileHeight').value,
                    occupation: document.getElementById('editProfileOccupation').value,
                    hobbies: document.getElementById('editProfileHobbies').value,
                    referrer: document.getElementById('editProfileReferrer').value,
                    comment: document.getElementById('editProfileComment').value,
                    media: mediaData,
                    social: parseSocialLinks(document.getElementById('editProfileSocial').value)
                };
                
                saveDataToStorage();
                loadProfiles();
                hideEditProfileForm();
                showAlert('success', 'ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
            }
        });

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Data URLã¨ã—ã¦èª­ã¿è¾¼ã‚€é–¢æ•°
        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = e => resolve(e.target.result);
                reader.onerror = e => reject(e);
                reader.readAsDataURL(file);
            });
        }

        // SNSãƒªãƒ³ã‚¯ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹é–¢æ•°
        function parseSocialLinks(socialText) {
            var socialLinks = [];
            if (socialText.trim()) {
                var lines = socialText.split('\n');
                for (var i = 0; i < lines.length; i++) {
                    var parts = lines[i].split(':');
                    if (parts.length >= 2) {
                        socialLinks.push({
                            platform: parts[0].trim(),
                            url: parts.slice(1).join(':').trim()
                        });
                    }
                }
            }
            return socialLinks;
        }

        // åˆæœŸåŒ–
        console.log('ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹');
        loadStoredData(); // ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€

        function previewImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">`;
                }
                reader.readAsDataURL(file);
            }
        }

        function previewVideo(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<video controls><source src="${e.target.result}" type="${file.type}">å‹•ç”»ã‚’å†ç”Ÿã§ãã¾ã›ã‚“</video>`;
                }
                reader.readAsDataURL(file);
            }
        }

        // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä¸€è¦§ã«æˆ»ã‚‹å‡¦ç†ã‚’ç°¡ç•¥åŒ–
        function restoreProfileList() {
            loadProfiles();
            var adminPanel = document.getElementById('adminPanel');
            if (adminPanel && currentUser && currentUser.role === 'admin') {
                adminPanel.style.display = 'block';
            }
        }

        // ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        function handleMediaUpload(input, type, isEdit = false) {
            const previewGrid = document.getElementById(isEdit ? 'editMediaPreviewGrid' : 'mediaPreviewGrid');
            const files = Array.from(input.files);
            
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const mediaItem = document.createElement('div');
                    mediaItem.className = 'media-preview-item';
                    
                    if (type === 'image') {
                        mediaItem.innerHTML = `
                            <img src="${e.target.result}" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">
                            <button class="remove-media" onclick="removeMedia(this)">Ã—</button>
                            <input type="hidden" name="mediaData" value="${e.target.result}">
                            <input type="hidden" name="mediaType" value="image">
                        `;
                    } else {
                        mediaItem.innerHTML = `
                            <video controls>
                                <source src="${e.target.result}">
                                å‹•ç”»ã‚’å†ç”Ÿã§ãã¾ã›ã‚“
                            </video>
                            <button class="remove-media" onclick="removeMedia(this)">Ã—</button>
                            <input type="hidden" name="mediaData" value="${e.target.result}">
                            <input type="hidden" name="mediaType" value="video">
                        `;
                    }
                    
                    previewGrid.appendChild(mediaItem);
                };
                reader.readAsDataURL(file);
            });
        }

        // ãƒ¡ãƒ‡ã‚£ã‚¢èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã®å‡¦ç†ã‚’è¿½åŠ 
        function handleMediaLoad(element) {
            element.closest('.media-item').classList.add('loaded');
        }
    </script>
</body>
</html>